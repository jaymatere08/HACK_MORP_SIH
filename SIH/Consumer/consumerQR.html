<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumer QR</title>
  <link rel="icon" type="image" href="C:\Users\sarth\OneDrive\Attachments\Desktop\SIH\Logo_top.png">
  <link rel="stylesheet" href="consumerQR.css">
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    
  <div class="navbar">
    <div class="webisteName">
      <span><h4>KrishiChain </h4></span>
    </div>
    <div class="nav-options">
      <a href="consumerPage.html"><button type="button">ğŸ  Home</button></a>
      <a href="consumerMarket.html"><button type="button">ğŸ›’ Marketplace</button></a>
      <a href="consumerQR.html"><button type="button">ğŸ“± QR Search</button></a>
      <button onclick="logoutUser()">Logout</button>
    </div>
  </div>

  <div class="main">
    <div class="QR-dash">
      <div class="heading">
        <p><b>Product Verification with QR Code</b></p>
        <p>Scan or enter a QR code to verify product authenticity and trace its journey</p>
      </div>

      <div class="QR-scanner">
        <p>QR Code</p>
        <div class="scanner">
          <input type="text" id="qr-input" class="QR-Code" placeholder="Enter QR Code (e.g, QR-WH-2022-001)">
          <button class="scan-btn" onclick="startScanner()">ğŸ“· Scan</button>
          <button type="button" class="Search" onclick="searchQR()">ğŸ” Search</button>
        </div>
        
        <!-- QR Scanner Preview -->
        <div id="qr-reader" style="width: 350px; margin-top: 15px; display:none;"></div>
        <div id="qr-result" style="margin-top: 15px; font-weight:bold;"></div>
      </div>
    </div>
  </div>

  <script>
    let html5QrCode;

    function startScanner() {
      const qrReader = document.getElementById("qr-reader");
      qrReader.style.display = "block";

      html5QrCode = new Html5Qrcode("qr-reader");
      const config = { fps: 10, qrbox: 250 };

      html5QrCode.start(
        { facingMode: "environment" }, // rear camera
        config,
        qrCodeMessage => {
          document.getElementById("qr-result").innerText = "âœ… QR Scanned: " + qrCodeMessage;

          if (qrCodeMessage.startsWith("http")) {
            window.location.href = qrCodeMessage;
          } else {
            
            alert("Product Details for: " + qrCodeMessage);
          }

          
          html5QrCode.stop().then(() => {
            qrReader.style.display = "none";
          });
        },
        errorMessage => {
        }
      );
    }

    function searchQR() {
      const qrValue = document.getElementById("qr-input").value;
      if (qrValue.trim() === "") {
        alert("Please enter a QR code value");
        return;
      }
      alert("Searching product for QR: " + qrValue);

    }

    function logoutUser() {
      localStorage.removeItem("userData");
      alert("You have been logged out!");
      window.location.href = "loginConsumer.html";
    }
  </script>
</body>
</html>